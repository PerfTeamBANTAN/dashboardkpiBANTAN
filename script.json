function doGet(e) {
  const kategori = (e.parameter.kategori || "").toLowerCase();

  let data = [];

  if (kategori === 'racing mitra') {
    const sheet = SpreadsheetApp.openById('1J1c54S6RQUK1D48tSP45AoYXpbFzWcSwO7G6imrxRpY').getSheetByName('RACING');
    const values = sheet.getDataRange().getValues();
    data = values.slice(1, 13);
    data = data.map(row => ({
      nama: row[0],
      sektor: row[1],
      gms: row[2],
      zero: row[3],
      ach_zero: row[4],
      pi12: row[5],
      ach_pi12: row[6],
      kpi: row[7],
      ach_kpi: row[8],
      tnps: row[9],
      ach_tnps: row[10],
      psb: row[11],
      ach_psb: row[12],
      realisasi: row[13],
      rank: row[14]
    }));
  } else if (kategori === 'racing hsa') {
    const sheet = SpreadsheetApp.openById('1J1c54S6RQUK1D48tSP45AoYXpbFzWcSwO7G6imrxRpY').getSheetByName('RACING');
    const values = sheet.getDataRange().getValues();
    const sliced = values.slice(14, 23);
    data = sliced.map(row => ({
      nama: row[0],
      sektor: row[1],
      gms: row[2],
      zero: row[3],
      ach_zero: row[4],
      pi12: row[5],
      ach_pi12: row[6],
      kpi: row[7],
      ach_kpi: row[8],
      tnps: row[9],
      ach_tnps: row[10],
      psb: row[11],
      ach_psb: row[12],
      realisasi: row[13],
      rank: row[14]
    }));
  } else if (kategori === '12 pi laten') {
    const sheet = SpreadsheetApp.openById('1J1c54S6RQUK1D48tSP45AoYXpbFzWcSwO7G6imrxRpY').getSheetByName('12 PI LATEN');
    const values = sheet.getDataRange().getValues();
    const headers = values[0];
    const body = values.slice(1);

    data = body.map(row => {
      let obj = {};
      headers.forEach((h, i) => {
        obj[h] = row[i];
      });
      return obj;
    });
  } else if (kategori === 'dashboard ioan b2c') {
    const sheet = SpreadsheetApp.openById('1J1c54S6RQUK1D48tSP45AoYXpbFzWcSwO7G6imrxRpY').getSheetByName('KPI B2C');
    const values = sheet.getDataRange().getValues();
    const headers = values[0];
    const body = values.slice(1);

    data = body.map(row => {
      let obj = {};
      headers.forEach((h, i) => {
        obj[h] = row[i];
      });
      return obj;
    });
  } else if (kategori === 'racing ioan mitra') {
    const sheet = SpreadsheetApp.openById('1J1c54S6RQUK1D48tSP45AoYXpbFzWcSwO7G6imrxRpY').getSheetByName('IOAN MITRA');
    const values = sheet.getDataRange().getValues();

    const headers = values[0];
    const body = values.slice(1, 30);   
    const rankingRow = values[30] || [];

    const finalData = [...body];
    if (rankingRow.length && rankingRow[0].toString().toLowerCase().includes('ranking')) {
    finalData.push(rankingRow);
  }

  finalData.unshift(headers);

  return ContentService
    .createTextOutput(JSON.stringify(finalData))
    .setMimeType(ContentService.MimeType.JSON);


  } else {
    return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.JSON);
  }

  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}
